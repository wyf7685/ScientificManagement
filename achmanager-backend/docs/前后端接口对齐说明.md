# 前后端接口对齐说明（Mock 保留）

本说明用于描述当前前端与后端接口的对齐方式，以及仍使用 Mock 的接口范围。

## 约定

- 后端接口以 `achmanager-backend/docs/API.md` 为准。
- 前端全局 Mock 维持开启（`VITE_USE_MOCK=true`）。
- 对已有后端实现的接口，前端显式 `mock: false` 走后端；未实现的接口继续走 Mock。
- 后端 `Result` 成功码文档为 `code=0`，实际实现为 `code=1`；前端已兼容 `0/1/200`。

## 已对齐（走后端）

### 成果物列表/详情/新增/更新/删除

- `getResults` → `POST /admin/achievement/pageList`
- `getMyResults` → `POST /user/achievement/pageList`
- `getVisibleResults` → `POST /user/achievement/pageListAllVisible`
- `getResult` → `GET /user/achievement/detail?achDocId=...`
- `createResult` → `POST /user/achievement/create`
- `updateResult` → `PUT /user/achievement/update/{achievementDocId}`
- `deleteResult` → `PUT /admin/achievement/delete/{achievementDocId}`

说明：
- 列表返回 `Page` 结构，前端统一映射为 `{ data: { list, total, page, pageSize } }`。
- 仅映射 `keyword/type/status/projectId` 等基础查询字段；`yearRange/author/sortBy` 等暂不支持。
- 详情数据映射为前端模型字段（`id/typeId/metadata/...`），未提供字段默认留空。
- 更新时前端会回传字段值 `documentId`，后端优先按字段值更新，避免重复新增。

### 成果类型

- `getResultTypes` → `POST /achievementType/list`
- `createResultType` → `POST /achievementType/types`
- `updateResultType` → `PUT /achievementType/types/{typeDocId}`
- `deleteResultType` → `PUT /achievementType/types/{typeDocId}/delete`

### 字段定义（新增/更新/删除）

- `createFieldDef` → `POST /achievementFieldDef/create`
- `updateFieldDef` → `PUT /achievementFieldDef/defs/{fieldDefDocId}`
- `deleteFieldDef` → `PUT /achievementFieldDef/delete/{fieldDefDocId}`

### 字段定义列表（按类型）

前端通过 `GET /achievementType/detail?typeDocId=...` 获取 `fieldDefinitions` 并转换为前端字段定义结构。

说明：
- `fieldDefinitions` 缺少 `is_required`，前端默认按非必填处理。

### 智能补全（期刊等级）

- `autoFillMetadata(type=journalRank)` → `GET /results/auto-fill`

### 统计图表（新增对齐）

- `getTypePie` → `/admin/stat/typePie`

## 保持 Mock（未实现后端逻辑）

### 认证

- `/auth/*` 登录、登出、当前用户

### 统计与洞察

- `/results/statistics`
- `/results/my-statistics`
- `/results/advanced-distribution`
- `/results/stacked-trend`
- `/results/keywords`
 
说明：
- 成果分布的“类型”维度已走后端 `/admin/stat/typePie`。
- **前端看板（含管理员视图）逻辑已更新**：使用 `/admin/stat/typePie` 的真实数据在前端动态计算“总成果数”、“论文数”和“专利数”，不再依赖 Mock 统计接口；仅“本月新增”保留 Mock 或逻辑推算。
- 其余高级统计维度（部门、收录级别）仍走 Mock。

### 审核/访问/智能补全

- `/results/:id/submit`
- `/results/:id/review`
- `/results/:id/assign-reviewers`
- `/results/:id/request-changes`
- `/results/:id/format-check`
- `/results/:id/format-reject`
- `/results/review-backlog`
- `/results/:id/access-requests`
- `/results/access-requests`
- `/results/access-requests/:id/review`
- `/results/auto-fill`

说明：
- 智能补全仅 `journalRank` 走后端代理，其余类型仍走 Mock。
- 后端代理会对期刊名进行 URL 编码，并限制请求频率（最多 2 次/秒）。

### 草稿/导出/上传

- `/results/draft`
- `/results/export`
- `/upload`（附件上传）

说明：
- `export` 目前返回 Mock 占位文件内容。

### 其他业务模块

- `/projects/*`
- `/demand/*`
- `/system/*`
- `/interim-results/*`

## 关键 TODO

- 对齐成果物详情字段（作者、年份、可见范围、附件等）与后端数据结构。
- 持续校验历史数据是否存在旧状态值（`REVIEWING/NEED_MODIFY`），并逐步统一到 `UNDER_REVIEW/NEEDS_MODIFICATION`。
- 对接附件上传与 `createWithFiles` / `updateWithFiles`。
- 补齐统计、审核、访问申请、智能补全等业务接口。
### 成果分布（类型饼图）

- `getTypePie` → `GET /admin/stat/typePie`
